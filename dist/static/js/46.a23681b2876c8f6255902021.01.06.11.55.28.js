webpackJsonp([46],{Oj1Z:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("mvHQ"),i=o.n(n),a=(o("uXZL"),o("7/x6")),s=o("tPPc"),r=o("Abov"),p=o("0xDb"),l={components:{shoppinggoods:s.default,"xlsx-com":a.default},props:{list:{type:String,default:""}},data:function(){return{fileName:"",visible:!1,visibles:!1,getPresentDetails:{},presentList:[],tableGoodsData:[],NtableGoodsData:[],promotionId:"",shopData:[],addList:[],promotionIdDet:"",subArr:[],promotionCode:"",tableData:[]}},mounted:function(){this.promotionId=this.$route.query.promotionId},methods:{checkSelectable:function(t){return"-1"!=t.dataState},getData:function(t,e){var o=this;this.fileName=e,this.subArr=[],t.forEach(function(t,e){o.subArr.push({rangeCode:t["*商品编码"],pprlOpurl:t["商品条码"],dataOpnextbillstate:0,pprlOpname:t["商品名称"]})})},addXl:function(){this.subArr=[],this.fileName="",this.visibles=!0},addShop:function(){this.visible=!0},goodschange:function(t){if("1"!=t){if(this.shopData=this.$store.state.mad.goodslist,this.shopData&&this.shopData.length>0){for(var e=[],o=0;o<this.shopData.length;o++)e.push({promotionCode:this.promotionCode,dataOpnextbillstate:0,rangeCode:this.shopData[o].skuNo,pprlOpname:this.shopData[o].goodsName,discountAmount1:this.shopData[o].pricesetNprice,pprlOpurl:this.shopData[o].skuBarcode});this.upDates(e)}}else this.visible=!1},submits:function(){var t=this;this.subArr&&this.subArr.length>0&&(this.subArr.map(function(e){e.promotionCode=t.promotionCode,e.dataOpnextbillstate=0}),this.upDates(this.subArr)),this.visibles=!1},upDates:function(t){var e=this;this.getPresentDetails.pmPromotionRangeList=t,Object(r.f)("paramStr="+encodeURI(i()(this.getPresentDetails))).then(function(t){t.success?(e.$message.success(t.msg),e.getPromotion()):e.$message.error(t.msg)})},handleSelectionChange:function(t){this.addList=[],this.addList=t},del:function(t){this.addList.push(t.row),this.deletes("1")},deletes:function(t){var e=this;1==this.addList.length?(this.promotionIdDet=this.addList[0].pprlId,Object(r.a)({pprlId:this.promotionIdDet}).then(function(t){t.success?(e.$message.success(t.msg),e.getPromotion()):e.$message.error(t.msg)})):"1"!=t&&0==this.addList.length?this.$message.error("请选择要删除的商品"):this.addList.length>1&&this.$message.error("一次最多只能删除一条")},changes:function(){var t=this,e=[],o=[];(e=this.tableGoodsData)&&e.map(function(e){(!t.optionOne||t.optionOne!=e.pprlOpname||t.optionTwo||t.optionThree)&&(!t.optionTwo||t.optionTwo!=e.rangeCode||t.optionOne||t.optionThree)&&(!t.optionThree||t.optionThree!=e.pprlOpurl||t.optionOne||t.optionTwo)?t.optionThree&&t.optionTwo&&t.optionThree==e.pprlOpurl&&t.optionTwo==e.rangeCode&&!t.optionOne?o.push(e):t.optionThree&&t.optionOne&&t.optionThree==e.pprlOpurl&&t.optionOne==e.pprlOpname&&!t.optionTwo?o.push(e):t.optionTwo&&t.optionOne&&t.optionTwo==e.rangeCode&&t.optionOne==e.pprlOpname&&!t.optionThree?o.push(e):t.optionTwo&&t.optionOne&&t.optionThree&&t.optionTwo==e.rangeCode&&t.optionOne==e.pprlOpname&&t.optionThree==e.pprlOpurl?o.push(e):t.optionTwo||t.optionOne||t.optionThree||(o.push(e),!0):o.push(e)}),this.NtableGoodsData=o},getPromotion:function(t){var e=this;this.presentList=[],Object(r.c)({promotionId:this.promotionId}).then(function(o){e.ssld(o,t)})},rePush:function(){var t=this;Object(r.h)({promotionId:this.promotionId}).then(function(e){e.success?t.$message.success(e.msg):t.$message.error(e.msg)})},ssld:function(t,e){t.promotionBegintime=t.promotionBegintime?Object(p.a)(t.promotionBegintime):t.promotionBegintime,t.promotionEndtime=t.promotionEndtime?Object(p.a)(t.promotionEndtime):t.promotionEndtime,t.gmtCreate=t.gmtCreate?Object(p.a)(t.gmtCreate):t.gmtCreate,t.gmtModified=t.gmtModified?Object(p.a)(t.gmtModified):t.gmtModified,this.promotionCode=t.promotionCode,this.getPresentDetails=t,this.tableData=t.pmPromotionSupList,this.tableGoodsData=t.pmPromotionRangeList,this.NtableGoodsData=t.pmPromotionRangeList,"1"==e&&this.changes()}},watch:{list:function(t,e){t&&this.ssld(t)}}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"magind"},[o("el-row",[o("div",{staticClass:"lefts"},[o("div",{staticClass:"name"},[t._v("商品名称：")]),t._v(" "),o("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:t.optionOne,callback:function(e){t.optionOne=e},expression:"optionOne"}})],1),t._v(" "),o("div",{staticClass:"lefts"},[o("div",{staticClass:"name"},[t._v("商品编码：")]),t._v(" "),o("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:t.optionTwo,callback:function(e){t.optionTwo=e},expression:"optionTwo"}})],1),t._v(" "),o("div",{staticClass:"lefts"},[o("div",{staticClass:"name"},[t._v("商品条码：")]),t._v(" "),o("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:t.optionThree,callback:function(e){t.optionThree=e},expression:"optionThree"}})],1)])],1),t._v(" "),o("div",{staticClass:"buttonsList"},[o("div",[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.getPromotion("1")}}},[t._v("查询")])],1),t._v(" "),o("div",[o("el-button",{attrs:{type:"primary"},on:{click:t.rePush}},[t._v("营销重推")]),t._v(" "),o("span",[t._v("总数："+t._s(t.NtableGoodsData.length)+"条")])],1)]),t._v(" "),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.NtableGoodsData,stripe:""},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"index",label:"序号"}}),t._v(" "),o("el-table-column",{attrs:{prop:"pprlOpname",label:"商品名称",width:"180"}}),t._v(" "),o("el-table-column",{attrs:{prop:"rangeCode",label:"商品编码",width:"180"}}),t._v(" "),o("el-table-column",{attrs:{prop:"pprlOpurl",label:"商品条码",width:"180"}}),t._v(" "),o("el-table-column",{attrs:{prop:"dataOpnextbillstate",label:"同步状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.dataOpnextbillstate?o("div",[t._v("同步成功")]):0==e.row.dataOpnextbillstate?o("div",[t._v("未同步")]):2==e.row.dataOpnextbillstate?o("div",[t._v("同步失败")]):-1==e.row.dataOpnextbillstate?o("div",[t._v("已删除")]):t._e()]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"dataState",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[-1==e.row.dataState?o("div",[t._v("已删除")]):0==e.row.dataState?o("div",[t._v("正常")]):t._e()]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"memo",label:"失败原因",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.dataOpnextbillstate?o("div",[t._v(t._s(e.row.memo))]):t._e()]}}])})],1),t._v(" "),o("shoppinggoods",{attrs:{shop:"plat",visible:t.visible},on:{receive:t.goodschange}}),t._v(" "),o("el-dialog",{attrs:{title:"批量导入",visible:t.visibles},on:{"update:visible":function(e){t.visibles=e}}},[o("div",{staticClass:"padding"},[o("xlsx-com",{staticClass:"leadCard",attrs:{buttonName:"选择文件"},on:{getData:t.getData}}),t._v(" "),o("el-button",{attrs:{type:"text"}},[o("a",{attrs:{href:"https://qjstatic.oss-cn-shanghai.aliyuncs.com/excel/promotionGoods.xlsx"}},[t._v("下载模板")])]),t._v(" "),o("div",{staticClass:"showContent"},[t._v(t._s(t.fileName))])],1),t._v(" "),o("div",{staticClass:"dia-btn flex justify-content--center padding"},[o("el-button",{attrs:{type:"info"},on:{click:function(e){t.visibles=!1}}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.submits}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var c=o("VU/8")(l,d,!1,function(t){o("yAy5")},"data-v-18227a50",null);e.default=c.exports},kNvr:function(t,e,o){(t.exports=o("FZ+f")(!1)).push([t.i,"\n.createPost-container[data-v-18227a50] {\n  min-height: 600px;\n  padding: 20px;\n  background: #fff;\n}\n.createPost-container .el-row[data-v-18227a50] {\n    padding-top: 20px;\n}\n.createPost-container .magind[data-v-18227a50] {\n    margin: 0 0 20px 0;\n    overflow: hidden;\n}\n.createPost-container .lefts[data-v-18227a50] {\n    overflow: hidden;\n    float: left;\n    margin-right: 2px;\n}\n.createPost-container .lefts .name[data-v-18227a50] {\n      float: left;\n      height: 32px;\n      line-height: 32px;\n      font-size: 14px;\n      color: #666;\n}\n.createPost-container .lefts .el-input[data-v-18227a50] {\n      width: 185px;\n}\n.createPost-container .buttonsList[data-v-18227a50] {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    margin: 0 20px 0 0;\n    -webkit-box-pack: justify;\n        -ms-flex-pack: justify;\n            justify-content: space-between;\n}\n.createPost-container .buttonsList span[data-v-18227a50] {\n      color: #666;\n}\n.createPost-container .padding[data-v-18227a50] {\n    padding-bottom: 30px;\n}\n",""])},yAy5:function(t,e,o){var n=o("kNvr");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);o("rjj0")("72c03168",n,!0)}});