webpackJsonp([40],{"2H53":function(t,e,s){var i=s("vEe5");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);s("rjj0")("0e003715",i,!0)},"9XP4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),a=s.n(i),o=(s("uXZL"),s("7/x6")),n=s("D9vr"),l=s("Abov"),r=(s("0xDb"),{components:{"template-table":s("FR2T").default,shoppinggoods:n.default,"xlsx-com":o.default},props:{list:{type:String,default:""}},data:function(){return{fileName:"",firstdata:[],visibleShop:!1,visible:!1,visibles:!1,getPresentDetails:{},presentList:[],tableGoodsData:[],NtableGoodsData:[],promotionId:"",shopData:[],addList:[],promotionIdDet:"",subArr:[],promotionCode:"",page:1,rows:10,tableData:[],url:"",temInput:[{name:"promotionCode",value:""},{label:"商品名称",type:"text",name:"pprlOpname",value:"",placeholder:"请输入商品名称"},{label:"商品编码",type:"text",name:"rangeCode",value:"",placeholder:"请输入商品编码"},{label:"商品条码",type:"text",name:"pprlOpurl",value:"",placeholder:"请输入商品条码"},{label:"同步状态",type:"select",name:"dataOpnextbillstate",placeholder:"请选择同步状态",value:"",options:[{label:"未同步",value:"0"},{label:"同步成功",value:"1"},{label:"同步异常",value:"2"},{label:"已删除",value:"-1"}]},{btnArray:[{type:"primary",id:"search",label:"查询",url:""},{type:"primary",id:"rePush",label:"营销重推",url:""}]}],temTable:{reserve_selection:!1,rowKey:"pprlId",selection:{state:!0,params:[]},tableHead:[{prop:"pprlOpname",label:"商品名称"},{prop:"rangeCode",label:"商品编码"},{prop:"pprlOpurl",label:"商品条码"},{prop:"discountAmount1",label:"价格"},{prop:"dataState",label:"状态",template:{0:"进行中",4:"未开始",1:"进行中",2:"已结束","-1":"已取消",3:"已终止",5:"审核失败"}},{prop:"dataOpnextbillstate",label:"同步状态",template:{0:"未同步",1:"同步成功",2:"同步异常","-1":"已删除"}},{prop:"discountAmount1",renderTemp:this.renderContentDates,label:"失败原因"}],tabBtnState:!1,tableBtn:[{label:"删除",dataState:"0",id:"delete",type:"primary"},{label:"删除",dataState:"1",id:"delete",type:"primary"},{label:"删除",dataState:"2",id:"delete",type:"primary"},{label:"删除",dataState:"3",id:"delete",type:"primary"},{label:"删除",dataState:"4",id:"delete",type:"primary"},{label:"删除",dataState:"5",id:"delete",type:"primary"}]}}},mounted:function(){var t=this;this.promotionId=this.$route.query.promotionId,this.promotionCode=this.$route.query.promotionCode,this.temInput[0].value=this.promotionCode,this.promotionCode&&(this.url="/web/pm/promotionRangelist/queryPromotionRangelistPagebyCode.json",this.$refs.templateTable.clickState=!0,this.$nextTick(function(){t.$refs.templateTable.getDataList()})),this.getPromotion()},methods:{firsthandleDelete:function(t,e){console.log(t,e),this.firstdata.splice(t,1)},renderContentDates:function(t,e){return"2"==e.dataOpnextbillstate?t("div",null,[t("p",null,[e.memo])]):t("div",null,[])},inputBtnClick:function(t,e){var s=this;"addShop"==t.id?(this.$store.commit("goodslistchange",""),this.firstdata=[],this.visibleShop=!0):"addXl"==t.id?(this.subArr=[],this.fileName="",this.visibles=!0):"deletes"==t.id?1==this.addList.length?"-1"==this.addList[0].dataState?this.$message.error("该商品已删除"):this.deletes():this.addList.length>1?this.$message.error("您一次只能删除一条"):this.$message.error("请勾选您要删除的商品"):"rePush"==t.id&&(this.getPresentDetails.pmPromotionRangeList=null,this.getPresentDetails.delPmPromotionRangeList=null,Object(l.i)("paramStr="+encodeURI(a()(this.getPresentDetails))).then(function(t){t.success?s.$message.success(t.msg):s.$message.error(t.msg),s.$refs.templateTable.getDataList()})),console.log(t,"得到的")},tableBtnClick:function(t,e,s){"delete"===e.id&&(this.addList=[],this.addList.push(t),this.deletes())},getGoods:function(){this.visible=!0},deletes:function(){var t=this;this.promotionIdDet=this.addList[0].pprlId,Object(l.b)({pprlId:this.promotionIdDet}).then(function(e){e.success?(t.$message.success(e.msg),t.$refs.templateTable.getDataList()):t.$message.error(e.msg)})},getData:function(t,e){var s=this;this.fileName=e,this.subArr=[],t.forEach(function(t,e){s.subArr.push({rangeCode:t["*商品编码"],pprlOpurl:t["商品条码"],dataOpnextbillstate:0,discountAmount1:t["*活动价格"],pprlOpname:t["商品名称"]})})},handleSelectionChange:function(t,e){this.addList=[],this.addList=t},goodschange:function(t){"1"!=t?this.firstdata=this.$store.state.mad.goodslist:this.visible=!1},submits:function(){var t=this;if(this.subArr&&this.subArr.length>0){this.subArr.map(function(e){e.promotionCode=t.promotionCode,e.dataOpnextbillstate=0});for(var e=/(^[1-9](\d+)?(\.\d{1,2})?$)|(^\d\.\d{1,2}$)/,s=0;s<this.subArr.length;s++){if(""==this.subArr[s].discountAmount1||null==this.subArr[s].discountAmount1||void 0==this.subArr[s].discountAmount1)return this.$message.error("活动价不能为空"),!1;if(!e.test(this.subArr[s].discountAmount1))return this.$message.error("活动价大于0且最多为两位小数"),!1}this.upDates(this.subArr),this.visibles=!1}},upDates:function(t){var e=this;this.getPresentDetails.pmPromotionRangeList=t,Object(l.g)("paramStr="+encodeURI(a()(this.getPresentDetails))).then(function(t){t.success?(e.$message.success(t.msg),e.$refs.templateTable.getDataList()):e.$message.error(t.msg)})},subList:function(t){if(this.shopData=this.firstdata,this.shopData&&this.shopData.length>0){for(var e=[],s=/(^[1-9](\d+)?(\.\d{1,2})?$)|(^\d\.\d{1,2}$)/,i=0;i<this.firstdata.length;i++){if(""==this.firstdata[i].discountAmount1||null==this.firstdata[i].discountAmount1||void 0==this.firstdata[i].discountAmount1)return this.$message.error("活动价不能为空"),!1;if(!s.test(this.firstdata[i].discountAmount1))return this.$message.error("活动价大于0且最多为两位小数"),!1;e.push({rangeCode:this.firstdata[i].skuNo,pprlOpname:this.firstdata[i].goodsName,pprlOpurl:this.firstdata[i].skuBarcode,discountAmount1:this.firstdata[i].discountAmount1})}this.visibleShop=!1,this.upDates(e)}else this.$message.error("您还未选择商品")},getPromotion:function(t){var e=this;this.presentList=[],Object(l.c)({promotionId:this.promotionId}).then(function(t){e.getPresentDetails=t})},renderHeader:function(t,e){var s=e.column;return t("div",[t("i",{style:"color:#f56c6c"},["*"]),t("span",s.label)])}},watch:{list:function(t,e){t&&(console.log(t,"对的"),this.getPresentDetails=t)}}}),d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("template-table",{ref:"templateTable",attrs:{temInput:t.temInput,url:t.url,temTable:t.temTable},on:{inputBtnClick:t.inputBtnClick,tableBtnClick:t.tableBtnClick,toggleSelection:t.toggleSelection,handleSelectionChange:t.handleSelectionChange,btnConfirm:t.btnConfirm}}),t._v(" "),s("shoppinggoods",{attrs:{shop:"plat",visible:t.visible},on:{receive:t.goodschange}}),t._v(" "),s("el-dialog",{attrs:{title:"批量导入",visible:t.visibles},on:{"update:visible":function(e){t.visibles=e}}},[s("div",{staticClass:"padding"},[s("xlsx-com",{staticClass:"leadCard",attrs:{buttonName:"选择文件"},on:{getData:t.getData}}),t._v(" "),s("el-button",{attrs:{type:"text"}},[s("a",{attrs:{href:"https://qjstatic.oss-cn-shanghai.aliyuncs.com/excel/proSecGoods.xlsx"}},[t._v("下载模板")])]),t._v(" "),s("div",{staticClass:"showContent"},[t._v(t._s(t.fileName))])],1),t._v(" "),s("div",{staticClass:"dia-btn flex justify-content--center padding"},[s("el-button",{attrs:{type:"info"},on:{click:function(e){t.visibles=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.submits}},[t._v("确定")])],1)]),t._v(" "),s("el-dialog",{attrs:{title:"选择商品",visible:t.visibleShop,width:"70%"},on:{"update:visible":function(e){t.visibleShop=e}}},[s("div",[s("el-button",{attrs:{type:"primary"},on:{click:t.getGoods}},[t._v("选择商品")]),t._v(" "),s("el-table",{key:"firstTable",attrs:{data:t.firstdata}},[s("el-table-column",{attrs:{label:"商品条码",prop:"skuBarcode"}}),t._v(" "),s("el-table-column",{attrs:{label:"商品编码",prop:"skuNo"}}),t._v(" "),s("el-table-column",{attrs:{label:"商品名称",prop:"goodsName"}}),t._v(" "),s("el-table-column",{attrs:{label:"活动价格",prop:"discountAmount1","render-header":t.renderHeader},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-input",{attrs:{type:"text",name:"discountAmount1",placeholder:"请输入活动价格"},model:{value:e.row.discountAmount1,callback:function(s){t.$set(e.row,"discountAmount1",s)},expression:"scope.row.discountAmount1"}})]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(s){t.firsthandleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),s("div",{staticClass:"dia-btn flex justify-content--center padding"},[s("el-button",{attrs:{type:"info"},on:{click:function(e){t.visibleShop=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.subList}},[t._v("确定")])],1)])],1)},staticRenderFns:[]};var u=s("VU/8")(r,d,!1,function(t){s("2H53")},"data-v-32699cad",null);e.default=u.exports},vEe5:function(t,e,s){(t.exports=s("FZ+f")(!1)).push([t.i,"\n.padding[data-v-32699cad] {\n  padding: 30px 0;\n}\n",""])}});