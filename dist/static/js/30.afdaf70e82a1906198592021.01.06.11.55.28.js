webpackJsonp([30],{"2nfr":function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=t("mvHQ"),s=t.n(l),o=t("pFYg"),n=t.n(o),a=(t("Wivf"),t("zL8q"),t("E4LH")),r={props:{fileList:Array,type:String,limit:Number,visible:Boolean,imgType:String,num:Number,multiple:{type:Boolean,default:!1},fileUploadUrl:{type:String,default:(location.href.split(":")[0]||"http")+"://"+location.hostname+":"+(location.port?location.port:"")+"/web/rs/goodsFile/uploadGoodsFile.json"}},data:function(){return{title:"选择图片",diaVisible:!1,fileUrl:"",imgType:"jpg/png/gif",num:5,picLimit:this.limit||1,nFileList:this.fileList||[],otherData:{tenantCode:"00000001"},uploading:[]}},activated:function(){console.log("组件被激活了")},methods:{uploadPic:function(i,e){this.rowSer=e,this.defaultPicList=e.rsGoodsFileDomainList,this.diaVisible=!0},handelClose:function(){this.nFileList=[],this.fileUrl="",this.$refs.picUpload.abort(),this.uploading=[],this.$emit("toggle",!1)},handleRemove:function(i,e){var t=this.uploading.indexOf(i.uid);t>-1&&this.uploading.splice(t,1),this.nFileList=e},beforeAvatarUpload:function(i){console.log(i,"file",this.beforeAvatarUpload);var e=/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(i.name.toLowerCase());e||this.$message.error("图片格式为常见的jpg、png、gif格式！");var t=i.size/1024/1024<5;return t||this.$message.error("上传的图片大小不能超过 5MB!"),t&&e&&this.uploading.push(i.uid),t&&e},beforeUpload:function(i){var e=/\.(mp4|ogg|flv|mkv|MP4|FLV|MKV|OGG)$/.test(i.name.toLowerCase());e||this.$message.error("文件格式为常见的mp4,ogg,flv,mkv格式！");var t=i.size/1024/1024<5;return t||this.$message.error("上传的文件大小不能超过5MB!"),t&&e&&this.uploading.push(i.uid),t&&e},handelSuccess:function(i,e,t){if(console.log(i),console.log(e),console.log(t),i&&"object"==(void 0===i?"undefined":n()(i))&&"success"in i&&!i.success){var l=JSON.parse(i.data.dataObj),s=window.location.href;window.location.href=l.loginurl+"?url="+s}else{var o={name:e.name,url:i.fileUrl,goodsFileUrl:i.fileUrl,uid:e.uid,goodsFileType:this.type,goodsFileName:i.fileCode,status:"success"},a=this.uploading.indexOf(e.uid);this.uploading.splice(a,1),t.splice(t.indexOf(e),1,o),console.log(t),this.nFileList=t}},handelError:function(i,e,t){console.log(response,this.fileUploadUrl,"handelErrorhandelErrorhandelErrorhandelErrorhandelErrorhandelErrorhandelErrorhandelError"),console.log(e),console.log(t)},changeFile:function(){this.nFileList.length>=this.picLimit?this.$message.error("最多上传"+this.picLimit+("0"==this.type?"张图片":"个文件")):this.$refs.picUpload.$refs["upload-inner"].$el.dispatchEvent(new MouseEvent("click"))},getNetFile:function(){if(this.nFileList.length>=this.picLimit)return this.$message.error("最多上传"+this.picLimit+("0"==this.type?"张图片":"个文件")),void(this.fileUrl="");if(Object(a.a)(this.fileUrl)){var i={url:this.fileUrl,goodsFileUrl:this.fileUrl,name:this.fileUrl,goodsFileType:this.type};this.nFileList.push(i),this.fileUrl=""}else this.$message.error("请输入正确的图片地址")},setPicList:function(i,e,t){},beyond:function(){this.$message.error("最多5张!")},setFileList:function(){var i=this,e=[];this.nFileList.length>0&&(e=JSON.parse(s()(this.nFileList))),console.log(this.$refs.picUpload),this.uploading.length>0?this.$confirm("请确认所有文件都上传完成，继续操作会移除正在上传的文件！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$refs.picUpload.abort(),i.$emit("setFileList",e),i.diaVisible=!1}).catch(function(){}):(this.$emit("setFileList",e),this.diaVisible=!1)}},mounted:function(){console.log(this.multiple,"multiple")},watch:{visible:function(){var i=this;if(this.diaVisible=this.visible,this.visible){var e=[];this.fileList.length>0&&(e=JSON.parse(s()(this.fileList))).forEach(function(i){i.url=i.goodsFileUrl||i.url}),this.$nextTick(function(){i.$refs.picUpload.$refs["upload-inner"].$el.style.display="none"}),this.nFileList=e}this.type&&"1"==this.type?this.title="选择文件":this.title="选择图片"},limit:function(){this.picLimit=this.limit||1},fileList:function(){var i=[];this.fileList.length>0&&(i=JSON.parse(s()(this.fileList))),this.nFileList=i,console.log(this.nFileList)}}},c={render:function(){var i=this,e=i.$createElement,t=i._self._c||e;return t("el-dialog",{attrs:{title:i.title,width:"55%","append-to-body":!0,visible:i.diaVisible},on:{"update:visible":function(e){i.diaVisible=e},close:i.handelClose}},[i.type&&"0"!=i.type?t("el-form",{staticClass:"dialog-form"},[t("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"上传本地文件"}},[t("el-button",{staticClass:"file-btn",attrs:{type:"primary"},on:{click:i.changeFile}},[i._v("添加文件")]),i._v(" "),t("span",{staticClass:"el-upload__tip cor-red"},[i._v("只能上传常见的mp4,ogg,flv,mkv格式文件，且不超过5M，最多上传"+i._s(i.picLimit)+"个")])],1),i._v(" "),t("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"添加网络文件"}},[t("el-col",{attrs:{span:14}},[t("el-input",{model:{value:i.fileUrl,callback:function(e){i.fileUrl=e},expression:"fileUrl"}})],1),i._v(" "),t("el-col",{attrs:{span:5,offset:1}},[t("el-button",{attrs:{type:"primary"},on:{click:i.getNetFile}},[i._v("提取")])],1)],1)],1):t("el-form",{staticClass:"dialog-form"},[t("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"上传本地图片"}},[t("el-button",{staticClass:"file-btn",attrs:{type:"primary"},on:{click:i.changeFile}},[i._v("添加图片")]),i._v(" "),t("span",{staticClass:"el-upload__tip cor-red"},[i._v("只能上传"+i._s(i.imgType)+"文件，且不超过"+i._s(i.num||5)+"M，最多上传"+i._s(i.picLimit)+"张")])],1),i._v(" "),t("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"添加网络图片"}},[t("el-col",{attrs:{span:14}},[t("el-input",{model:{value:i.fileUrl,callback:function(e){i.fileUrl=e},expression:"fileUrl"}})],1),i._v(" "),t("el-col",{attrs:{span:5,offset:1}},[t("el-button",{attrs:{type:"primary"},on:{click:i.getNetFile}},[i._v("提取")])],1)],1)],1),i._v(" "),t("div",{staticClass:"file-list"},[i.type&&"0"!=i.type?t("el-upload",{ref:"picUpload",attrs:{action:i.fileUploadUrl,data:i.otherData,"with-credentials":!0,"on-success":i.handelSuccess,"on-error":i.handelError,"on-remove":i.handleRemove,"before-upload":i.beforeUpload,"file-list":i.nFileList,multiple:i.multiple}}):t("el-upload",{ref:"picUpload",staticClass:"pic-div",attrs:{action:i.fileUploadUrl,data:i.otherData,"before-upload":i.beforeAvatarUpload,"on-success":i.handelSuccess,"with-credentials":!0,"on-remove":i.handleRemove,"list-type":"picture-card","file-list":i.nFileList,multiple:i.multiple}})],1),i._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(e){i.diaVisible=!1}}},[i._v("取消")]),i._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:i.setFileList}},[i._v("确定")])],1)],1)},staticRenderFns:[]};var d=t("VU/8")(r,c,!1,function(i){t("Znei")},"data-v-64b963ef",null);e.default=d.exports},"9p6x":function(i,e,t){(i.exports=t("FZ+f")(!1)).push([i.i,"\n.dialog-form[data-v-64b963ef] {\n  width: 100%;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding-left: 20px;\n}\n.dialog-form .dialog-form-item[data-v-64b963ef] {\n    width: 100% !important;\n    margin-left: 0 !important;\n}\n.el-dialog[data-v-64b963ef] {\n  border-radius: 6px;\n}\n.file-btn[data-v-64b963ef] {\n  position: relative;\n  overflow: hidden;\n}\n.file-input[data-v-64b963ef] {\n  display: none;\n}\n.cor-red[data-v-64b963ef] {\n  color: #ff0000;\n}\n",""])},Znei:function(i,e,t){var l=t("9p6x");"string"==typeof l&&(l=[[i.i,l,""]]),l.locals&&(i.exports=l.locals);t("rjj0")("77468d15",l,!0)}});