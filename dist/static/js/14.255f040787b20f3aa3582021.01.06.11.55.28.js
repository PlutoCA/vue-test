webpackJsonp([14],{"/OHE":function(i,t,e){var l=e("iLbz");"string"==typeof l&&(l=[[i.i,l,""]]),l.locals&&(i.exports=l.locals);e("rjj0")("a326069a",l,!0)},FoWk:function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,s=e("bOdI"),a=e.n(s),o=e("mvHQ"),n=e.n(o),r=e("pFYg"),c=e.n(r),h=(e("Wivf"),e("Cn+M")),f=(e("zL8q"),e("E4LH")),p=e("1nuA"),d=(l={props:{fileList:Array,type:String,limit:Number,visible:Boolean,imgType:String,num:{type:Number,default:5},multiple:{type:Boolean,default:!1},fileUploadUrl:{type:String,default:(location.href.split(":")[0]||"http")+"://"+location.hostname+":"+(location.port?location.port:"")+"/web/rs/goodsFile/uploadGoodsFile.json"},fileImgUrl:{type:String,default:(location.href.split(":")[0]||"http")+"://"+location.hostname+":"+(location.port?location.port:"")+"/web/fm/file/queryFilelistView.json?fileSort=FILE_GD"}},data:function(){return{checked:!0,activeName:"first",title:"选择图片",diaVisible:!1,fileUrl:"",imgType:"jpg/png/gif",nums:5,total:"",pageNo:1,pageSize:10,picLimit:this.limit||1,nFileList:this.fileList||[],otherData:{tenantCode:"00000001"},checkList:[],tabName:"",imgList:[],arrList:[],skuNo:"",btnShow:!0,imgState:!0,fileListArray:[],imgUrlArrayList:[],uploading:[]}},mounted:function(){},methods:{handleClick:function(i,t){this.tabName=i.name,"third"==i.name&&this.imgState&&(this.getImgData(),this.checkList=[])},hanlderFileImg:function(i){console.log(i,this.nFileList)},getImgData:function(){var i=this;console.log(this.fileImgUrl),Object(h.a)({url:this.fileImgUrl,method:"post",data:p.stringify({rows:this.pageSize,page:this.pageNo})}).then(function(t){console.log(t.rows),i.imgList=t.rows,i.arrList=i.arrList.concat(i.imgList),i.total=t.total,i.imgState=!1,t&&t.total>i.pageSize?i.btnShow=!0:i.btnShow=!1})},getSkuImg:function(){this.fileImgUrl=(location.href.split(":")[0]||"http")+"://"+location.hostname+":"+(location.port?location.port:"")+"/web/fm/file/queryFilelistView.json?fileSort=FILE_GD&fileRemark="+this.skuNo,this.arrList=[],this.pageNo=1,this.getImgData()},morePage:function(){this.pageNo++;var i=Math.ceil(this.total/this.pageSize);this.pageNo<=i?this.getImgData():this.btnShow=!1},handleSizeChange:function(i){this.pageSize=i,this.getImgData()},handleCurrentChange:function(i){this.pageNo=i,this.getImgData()},uploadPic:function(i,t){this.rowSer=t,this.defaultPicList=t.rsGoodsFileDomainList,this.diaVisible=!0},handelClose:function(){this.nFileList=[],this.fileUrl="",this.$refs.picUpload&&this.$refs.picUpload.abort(),this.uploading=[],this.$emit("toggle",!1)},handleRemove:function(i,t){var e=this;console.log(i,"0000"),this.checkList.forEach(function(t,l){"/paas/shop/"+t.fileUrl==i.url&&e.checkList.splice(l,1)});var l=this.uploading.indexOf(i.uid);l>-1&&this.uploading.splice(l,1),this.nFileList=t,this.fileListArray=[],this.nFileList.forEach(function(i){e.fileListArray.push(i.url)})},beforeAvatarUpload:function(i){console.log(i,"file",this.beforeAvatarUpload);var t=/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(i.name.toLowerCase());t||this.$message.error("图片格式为常见的jpg、png、gif格式！");var e=i.size/1024/1024<this.num?this.num:this.nums;return e||this.$message.error(this.num),e&&t&&this.uploading.push(i.uid),e&&t},beforeUpload:function(i){var t=/\.(mp4|ogg|flv|mkv|MP4|FLV|MKV|OGG)$/.test(i.name.toLowerCase());t||this.$message.error("文件格式为常见的mp4,ogg,flv,mkv格式！");var e=i.size/1024/1024<this.num?this.num:this.nums;return e||this.$message.error(this.num),e&&t&&this.uploading.push(i.uid),e&&t},handelSuccess:function(i,t,e){if(console.log(i),console.log(t),console.log(e,"999"),i&&"object"==(void 0===i?"undefined":c()(i))&&"success"in i&&!i.success){var l=JSON.parse(i.data.dataObj),s=window.location.href;window.location.href=l.loginurl+"?url="+s}else{var a={name:t.name,url:i.fileUrl,goodsFileUrl:i.fileUrl,uid:t.uid,goodsFileType:this.type,goodsFileName:i.fileCode,status:"success"},o=this.uploading.indexOf(t.uid);this.uploading.splice(o,1),e.splice(e.indexOf(t),1,a),console.log(e),this.nFileList=e}},handelError:function(i,t,e){console.log(response,this.fileUploadUrl,"handelErrorhandelErrorhandelErrorhandelErrorhandelErrorhandelErrorhandelErrorhandelError"),console.log(t),console.log(e)},changeFile:function(){this.nFileList.length>=this.picLimit?this.$message.error("最多上传"+this.picLimit+("0"==this.type?"张图片":"个文件")):this.$refs.picUpload.$refs["upload-inner"].$el.dispatchEvent(new MouseEvent("click"))},getNetFile:function(){if(this.nFileList.length>=this.picLimit)return this.$message.error("最多上传"+this.picLimit+("0"==this.type?"张图片":"个文件")),void(this.fileUrl="");if(Object(f.a)(this.fileUrl)){var i={url:this.fileUrl,goodsFileUrl:this.fileUrl,name:this.fileUrl,goodsFileType:this.type};this.nFileList.push(i),this.fileUrl=""}else this.$message.error("请输入正确的图片地址")},setPicList:function(i,t,e){},beyond:function(){this.$message.error("最多5张!")},setFileList:function(){var i=this,t=[];console.log(this.imgUrlArrayList,"xx imgUrlArrayList"),this.nFileList.length>0&&(t=JSON.parse(n()(this.nFileList))),this.checkList.forEach(function(e){i.imgUrlArrayList.indexOf("/paas/shop/"+e.fileUrl)<0&&t.push({url:"/paas/shop/"+e.fileUrl,goodsFileUrl:"/paas/shop/"+e.fileUrl,name:e.fileName})}),this.imgUrlArrayList=this.fileListArray,this.uploading.length>0?this.$confirm("请确认所有文件都上传完成，继续操作会移除正在上传的文件！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.$refs.picUpload.abort(),i.$emit("setFileList",t),i.diaVisible=!1}):(this.$emit("setFileList",t),this.diaVisible=!1)}}},a()(l,"mounted",function(){console.log(this.multiple,"multiple")}),a()(l,"watch",{visible:function(){var i=this;if(this.diaVisible=this.visible,this.visible){if(this.fileImgUrl&&this.fileImgUrl.lastIndexOf("&fileRemark")>-1){var t=this.fileImgUrl.lastIndexOf("=");console.log(t,t,"0000"),t>-1&&(console.log(t),this.skuNo=this.fileImgUrl.slice(t+1))}else this.skuNo="";console.log(this.skuNo,"00000");var e=[],l=[];this.fileList.length>0?((e=JSON.parse(n()(this.fileList))).forEach(function(t,e){i.fileListArray.indexOf(t.goodsFileUrl||t.url)>=0&&l.push(t.goodsFileUrl||t.url)}),this.checkList.forEach(function(t,e){l.indexOf("/paas/shop/"+t.fileUrl)<0&&i.checkList.splice(e,1)}),this.fileListArray=[],e.forEach(function(t){t.url=t.goodsFileUrl||t.url,i.fileListArray.push(t.url)})):(this.checkList=[],this.fileListArray=[]),this.$nextTick(function(){console.log(i.$refs),i.$refs&&(i.$refs.picUpload.$refs["upload-inner"].$el.style.display="none")}),this.nFileList=e}this.type&&"1"==this.type?this.title="选择文件":this.title="选择图片"},limit:function(){this.picLimit=this.limit||1},fileList:function(){var i=[];this.fileList.length>0&&(i=JSON.parse(n()(this.fileList))),this.nFileList=i,console.log(this.nFileList)}}),l),u={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("el-dialog",{staticClass:"file-box",attrs:{title:i.title,width:"766px","append-to-body":!0,visible:i.diaVisible},on:{"update:visible":function(t){i.diaVisible=t},close:i.handelClose}},[i.type&&"0"!=i.type?e("el-form",{staticClass:"dialog-form"},[e("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"上传本地文件"}},[e("el-button",{staticClass:"file-btn",attrs:{type:"primary"},on:{click:i.changeFile}},[i._v("添加文件")]),i._v(" "),e("span",{staticClass:"el-upload__tip cor-red"},[i._v("只能上传常见的mp4,ogg,flv,mkv格式文件，且不超过5M，最多上传"+i._s(i.picLimit)+"个")])],1),i._v(" "),e("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"添加网络文件"}},[e("el-col",{attrs:{span:14}},[e("el-input",{model:{value:i.fileUrl,callback:function(t){i.fileUrl=t},expression:"fileUrl"}})],1),i._v(" "),e("el-col",{attrs:{span:5,offset:1}},[e("el-button",{attrs:{type:"primary"},on:{click:i.getNetFile}},[i._v("提取")])],1)],1)],1):e("el-form",{staticClass:"dialog-form"},[e("span",{staticClass:"el-upload__tip cor-red"},[i._v("最多上传"+i._s(i.picLimit)+"张")]),i._v(" "),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":i.handleClick},model:{value:i.activeName,callback:function(t){i.activeName=t},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"上传本地图片",name:"first"}},[e("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"上传本地图片"}},[e("el-button",{staticClass:"file-btn",attrs:{type:"primary"},on:{click:i.changeFile}},[i._v("添加图片")]),i._v(" "),e("span",{staticClass:"el-upload__tip cor-red"},[i._v("只能上传"+i._s(i.imgType)+"文件，且不超过"+i._s(i.num||5)+"M")])],1)],1),i._v(" "),e("el-tab-pane",{attrs:{label:"添加网络图片",name:"second"}},[e("el-form-item",{staticClass:"dialog-form-item",attrs:{label:"添加网络图片"}},[e("el-col",{attrs:{span:14}},[e("el-input",{model:{value:i.fileUrl,callback:function(t){i.fileUrl=t},expression:"fileUrl"}})],1),i._v(" "),e("el-col",{attrs:{span:5,offset:1}},[e("el-button",{attrs:{type:"primary"},on:{click:i.getNetFile}},[i._v("提取")])],1)],1)],1),i._v(" "),e("el-tab-pane",{attrs:{label:"图片库",name:"third"}},[e("el-row",[e("el-col",{attrs:{span:2}},[i._v("货号：")]),i._v(" "),e("el-col",{attrs:{span:14}},[e("el-input",{model:{value:i.skuNo,callback:function(t){i.skuNo=t},expression:"skuNo"}})],1),i._v(" "),e("el-col",{attrs:{span:5,offset:1}},[e("el-button",{attrs:{type:"primary"},on:{click:i.getSkuImg}},[i._v("查询")])],1)],1),i._v(" "),e("el-row",{staticStyle:{"margin-top":"20px"}},[e("el-checkbox-group",{attrs:{max:i.picLimit||5},on:{change:i.hanlderFileImg},model:{value:i.checkList,callback:function(t){i.checkList=t},expression:"checkList"}},i._l(i.arrList,function(i,t){return e("el-checkbox",{key:t,attrs:{label:i}},[e("img",{directives:[{name:"lazy",rawName:"v-lazy",value:"/paas/shop/"+i.fileUrl,expression:"`/paas/shop/${item.fileUrl}`"}],staticClass:"image"})])})),i._v(" "),i.btnShow?e("div",{staticStyle:{"text-align":"center"}},[e("el-button",{attrs:{type:"text"},on:{click:i.morePage}},[i._v("更多")])],1):i._e()],1)],1)],1)],1),i._v(" "),e("div",{staticClass:"file-list"},[i.type&&"0"!=i.type?e("el-upload",{ref:"picUpload",attrs:{action:i.fileUploadUrl,data:i.otherData,"with-credentials":!0,"on-success":i.handelSuccess,"on-error":i.handelError,"on-remove":i.handleRemove,"before-upload":i.beforeUpload,"file-list":i.nFileList,multiple:i.multiple}}):e("el-upload",{ref:"picUpload",staticClass:"pic-div",attrs:{action:i.fileUploadUrl,data:i.otherData,"before-upload":i.beforeAvatarUpload,"on-success":i.handelSuccess,"with-credentials":!0,"on-remove":i.handleRemove,"list-type":"picture-card","file-list":i.nFileList,multiple:i.multiple}})],1),i._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(t){i.diaVisible=!1}}},[i._v("取消")]),i._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:0==i.uploading.length&&"first"==i.activeName||"second"==i.activeName||"third"==i.activeName,expression:'(uploading.length==0&&activeName=="first")||activeName=="second"||activeName=="third"'}],attrs:{type:"primary"},on:{click:i.setFileList}},[i._v("确定")])],1)],1)},staticRenderFns:[]};var m=e("VU/8")(d,u,!1,function(i){e("/OHE"),e("X1T/")},"data-v-2f2b8905",null);t.default=m.exports},"X1T/":function(i,t,e){var l=e("egE2");"string"==typeof l&&(l=[[i.i,l,""]]),l.locals&&(i.exports=l.locals);e("rjj0")("20d5e3fd",l,!0)},egE2:function(i,t,e){(i.exports=e("FZ+f")(!1)).push([i.i,"\n.file-box .el-checkbox {\n  margin-left: 30px;\n  position: relative;\n}\n.file-box .el-checkbox .el-checkbox__input {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n.file-box .el-checkbox .el-checkbox__label {\n    padding: 0;\n}\n.file-box .el-checkbox-group {\n  height: 230px;\n  overflow-y: scroll;\n}\n.file-box .el-upload-list--picture-card .el-upload-list__item {\n  width: 100px;\n  height: 100px;\n}\n",""])},iLbz:function(i,t,e){(i.exports=e("FZ+f")(!1)).push([i.i,'\n.dialog-form[data-v-2f2b8905] {\n  width: 100%;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding-left: 20px;\n}\n.dialog-form .dialog-form-item[data-v-2f2b8905] {\n    width: 100% !important;\n    margin-left: 0 !important;\n}\n.el-dialog[data-v-2f2b8905] {\n  border-radius: 6px;\n}\n.file-btn[data-v-2f2b8905] {\n  position: relative;\n  overflow: hidden;\n}\n.file-input[data-v-2f2b8905] {\n  display: none;\n}\n.cor-red[data-v-2f2b8905] {\n  color: #ff0000;\n}\n.image[data-v-2f2b8905] {\n  width: 100px;\n  height: 100px;\n  display: block;\n}\n.clearfix[data-v-2f2b8905]:before,\n.clearfix[data-v-2f2b8905]:after {\n  display: table;\n  content: "";\n}\n.clearfix[data-v-2f2b8905]:after {\n  clear: both;\n}\n.elcard[data-v-2f2b8905] {\n  margin-top: 20px;\n}\n',""])}});